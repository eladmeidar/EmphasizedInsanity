<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html style="-moz-binding: url(&quot;chrome://glass/content/xbl/stack.xml#stack&quot;);" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>Emphasized Insanity - Ninja testing your Rails plugins</title>
		<link href="/stylesheets/bundle_github.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/stylesheets/bundle_common.css" media="screen" rel="stylesheet" type="text/css">
    <script type="text/javascript" charset="utf-8">
      var GitHub = {}
      var github_user = 'eladmeidar'
      
    </script>
    <script src="/javascripts/jquery.js" type="text/javascript"></script>
    <script src="/javascripts/bundle_common.js" type="text/javascript"></script>
		<script src="/javascripts/bundle_github.js" type="text/javascript"></script>
		<link href="http://blog.eizesus.com/feed/atom.xml" rel="alternate" title="Emphasized Insanity" type="application/atom+xml">

    <meta name="description" content="Ruby on Rails developer blog">
  </head>
<body>
 
    <div class="subnavd" id="main">
      <div id="header" class="pageheaded">
        <div class="site">
          <div class="logo">
            <a href="/"><h1>Emphasized Insanity</h1></a>
          </div>          
			     <div class="userbox">
				     <div class="inner">
				       <div class="avatarname">
				         <a href="http://github.com/eladmeidar"><img alt="" src="/images/eladmeidar.jpg" height="20" width="20"></a>
				         <a href="http://twitter.com/eladmeidar" class="name">@eladmeidar</a>          
				       </div>
				       <ul class="usernav">
								 <li><a href="/about.html">About me</a></li>
				         <li><a href="http://www.linkedin.com/in/eladmeidar">LinkedIn</a></li>
				         <li><a href="http://workingwithrails.com/person/5844-elad-meidar">WWR</a></li>
				         <li><a href="http://github.com/eladmeidar">GitHub</a></li>
								 <li><a href="http://www.nautilus6.com">My Company</a></li>
				       </ul>
				     </div>
				   </div><!-- /.userbox -->
					 <div class="topsearch">
  
				    <form action="http://www.google.com/search?sitename=blog.eizesus.com" id="top_search_form" method="get">
				      <input autocomplete="off" class="search my_repos_autocompleter notnative placeholder ac_input" name="q" results="5" placeholder="Search…" type="search"> <input value="Search" class="button" type="submit">
				    </form>
  
  						<ul class="nav">
					      <li><a href="/archive.html">Explore Emphasized Insanity</a></li>
					    </ul>
  
						</div>

        </div>
      </div>        
    <div class="site">
      <div class="pagehead repohead vis-public">
        <h1> <a href="/">Emphasized Insanity</a> / <strong><a href="/">Blog</a></strong> </h1>
				<ul class="actions">
	        <li> <a href="http://blog.eizesus.com/feed/atom.xml" class="minibutton btn-watch " id="watch_button" style=""><span><span class="icon"></span>Subscribe</span></a></li>        
	        <li class="for-notforked" style=""><a href="#disqus-comments" class="minibutton btn-fork " id="fork_button"><span><span class="icon"></span>Comment</span></a></li>
    	  </ul>
				<ul class="tabs">
  				<li><a href="/" class="selected" highlight="repo_source">Source</a></li>
					<li><a href="/archive.html" highlight="repo_commits">Archive</a></li>
					<li><a href="http://www.railsbridge.org" highlight="issues">RailsBridge</a></li>
  				<li class="contextswitch nochoices">
				    <span class="toggle leftwards">
				      <em>Branch:</em>
				      <code>master</code>
				    </span>
				  </li>
				</ul>

<div class="subnav-bar">  
  <ul>
    <li>
      <a href="#" class="dropdown">Switch Branches (1)</a>
      <ul>
				<li><strong>master ✓</strong></li>
      </ul>
    </li>
  </ul>
</div> 
    <div id="repo_details" class="metabox clearfix  pledgified">
      <div id="repo_details_loader" class="metabox-loader" style="display: none;">Sending Request…</div>
        <a href="#pledgie_box" rel="facebox" title="Brought to you by pledgie.com" class="pledgie pledgie-button for-owner tooltipped" id="activate_pledgie_button" style="display: none;"><span>Enable Donations</span></a>
      		<div id="pledgie_box" style="display: none;">
        		<h2>Pledgie Donations</h2>
          </div>

      		<div id="repository_description" rel="repository_description_edit">
						<p>
							This is the personal homepage of Elad Meidar, a web developer and an entrepreneur specializing in Ruby on Rails. I am a proud member of <a href="http://www.railsbridge.org">RailsBridge</a>, Helping new <a href="http://www.railsmentors.org/users/185">Rails developers</a> get into our world and also contributed a few <a href="http://contributors.rubyonrails.org/contributors/elad-meidar/commits">Patches</a> to the Ruby on Rails core.
						</p>
						<p>
							I hang around Fort Lauderdale, FL and Tel-Aviv in Israel, and i am currently running <a href="http://www.nautilus6.com">Nautilus6</a> so Feel free to contact me regarding projects :).
						</p>
      		</div>
    		</div>
    </div><!-- /.pagehead -->
  <div id="commit">
    <div class="group">        
  		<div class="envelope commit">
    		<div class="human">
        <div class="message"><pre>Recent Posts</pre></div>
      

      <div class="actor">
        <div class="gravatar">
          <img alt="" src="images/eladmeidar.jpg" height="30" width="30">
        </div>
        <div class="name"><a href="/">Elad Meidar</a>
	 				<span>(author)</span>
				</div>
        <div class="date">
          <abbr class="relatize relatized" title="1984-06-19 06:06:07">about 25 years ago</abbr>
        </div>
      </div>
    </div>
    <div class="machine">
      <span>c</span>ommit&nbsp;&nbsp;<a href="#" hotkey="c">60fa264c54341711baef087347105a5b9dd68863</a><br>
      <span>t</span>ree&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" hotkey="t">508268ee6774e5c6060585718705f1ec7afa80d8</a><br>
        <span>p</span>arent&nbsp; <a href="#" hotkey="p">179f7c0440e6073779efc40366c6ced3a9888f71</a>    
    </div>
  </div>

    </div>
  </div>  
    <div id="path">
      <b><a href="/2009/11/ninja-testing-your-rails-plugins">Ninja testing your Rails plugins</a></b> / 
    </div>
		<div id="browser">
  		<table cellpadding="0" cellspacing="0">
    	<tbody><tr>
      <th></th>
      <th width="400p">name</th>
      <th>age</th>
      <th>
          history
      </th>
    </tr>
		<tr class="alt">
		  <td class="icon"> <img alt="file" src="/images/txt.png"> </td>
		  <td class="content">
				<a href="/2009/11/ninja-testing-your-rails-plugins" id="d8f8d46921aa81abc4c0d27703a8908333ae38c3">Ninja testing your Rails plugins</a>
			</td>
		  <td class="age">
				<span class="relatize relatized">11/11/2009</span> 
			</td>
		  <td class="message"> 
				<a href="/2009/11/ninja-testing-your-rails-plugins" class="message" title="another post">Another post</a> [Elad Meidar] 
			</td>
		</tr>
  </tbody></table>
</div>
  <div id="readme" class="announce"><span class="name"></span>
		<div class="wikistyle">
				<p>Testing plugins is much like testing your rails application, it uses the same rake and directory structure conventions which makes it a lot easier for who ever is already testing his Rails applications (you don&#8217;t? go away!).</p>
<p>Getting started will require you&#8217;ll have basic/advanced knowledge of the Rails conventions, testing methods and tools:</p>
<ul>
	<li><code>Test::Unit</code></li>
	<li>Rail&#8217;s database schema management</li>
	<li>rake</li>
</ul>
<p>I&#8217;ll try to cover as much as possible but i assume that if you have any issues with one of the following, you should probably go ahead and read up the <a href="http://guides.rubyonrails.org/testing.html">Rails testing guide</a> and maybe some of the other guides around while you are at it.</p>
<h2>Testing standalone plugins</h2>
<p>Testing plugins as part of a Rails application is pretty straight forward, you simply call:<br />
<pre>rake test:plugins</pre> or ,if you wish to run a specific plugin:<br />
<pre>rake test:plugins <span class="caps">PLUGIN</span>=name</pre><br />
Yeah, that easy.</p>
<p>That worked out for actually for a while, but i came to the conclusion that i shouldn&#8217;t force people to embed my plugin into their applications even before they were able to test it and see that it&#8217;s actually working.<br />
Another reason is that forcing people to include the plugin in an application, is making the process of contributing to it (assuming it&#8217;s open sourced, and it should be :) ) a bit more annoying.<br />
Encapsulating the entire plugin test suit into the actual plugin tree and removing all non-required dependencies, gives your plugin a more generic and independent form.</p>
<h2>General directory layout</h2>
<p>Like i noted before, the Rails plugin&#8217;s test directory is very similar to Rails&#8217;s own test directory structure:<br />
<pre>test/<br />
	fixtures/<br />
	lib/<br />
	functionals/<br />
	db/<br />
	unit/<br />
	Rakefile<br />
	test_helper.rb</pre></p>
<p>You don&#8217;t actually have to have all of those in your plugin test directory, depends on what you are actually testing, you might want to remove folders that are not related to your plugin&#8217;s functionality, for example ActiveRecord plugins will not need the <code>functionals/</code> directory on most cases, but will probably need some application structure stubs (i&#8217;ll get to that in the next section).</p>
<h2>Testing ActiveRecord plugins</h2>
<p>If your plugin has some functionality that extends ActiveRecord, or that relays on some ActiveRecord related built in functionality (associations for example) you&#8217;ll need to require the <code>activerecord</code> gem in your <code>test_helper.rb</code>:<br />
<pre>require &#8216;active_record&#8217;</pre></p>
<h3>Creating a standalone database</h3>
<p>Next, you&#8217;ll need a database. since you are not running as part of a Rails application test suit, you can&#8217;t use the default test database that ships with the Rails default test environment, you&#8217;ll have to create one.<br />
Since the goal we are after here, is to create somewhat a standalone plugin testing suit, the best way to get a standalone database is to create an <strong>in-memory sqlite3 database</strong>, which is also easy to configure:<br />
<script src="http://gist.github.com/232508.js"></script></p>
<h3>Loading the schema</h3>
<p>The plugin&#8217;s schema file is the file that hold all the database tables <span class="caps">DDL</span> that you will need in order to test your plugin. The syntax is just like the one Rails uses in its own <code>db/schema.rb</code>. To keep the conventions gods happy, i suggest creating a <code>db/</code> directory in your plugin root and create <code>schema.rb</code> there, here&#8217;s an example just in case:<br />
<script src="http://gist.github.com/232511.js"></script></p>
<p>After the schema is ready, we&#8217;ll need to load it by adding this line to <code>test_helper.rb</code>:<br />
<pre>load &#8216;test/db/schema.rb&#8217;</pre> (we include test/ in the path because we will be running <code>rake</code> from the plugin&#8217;s root directory).</p>
<h3>Fixtures</h3>
<p>Since we want a standalone testing suit, we will have to settle for fixtures as our database population tool and not on an external gem. create your <code>*.yml</code> fixtures under the <code>fixtures/</code> directory, then just require <code>'active_record/fixtures'</code> in your <code>test_helper.rb</code>:<br />
<script src="http://gist.github.com/232517.js"></script></p>
<h3>Models</h3>
<p>Since we require the <code>activerecord</code> gem, you can create ActiveRecord models. Personally i create a directory named <code>app/</code> under the plugin&#8217;s root directory and mock a real application directory. (e.g creating <code>models/</code>, <code>views/</code>, <code>controllers/</code> and whatever).</p>
<p>After you are done creating your model you&#8217;ll need to load them in your <code>test_helper.rb</code>:<br />
<pre>Dir[&#8216;test/db/app/models/<code>**</code>/*.rb&#8217;].each { |f| require f }</pre> should do it.</p>
<p>note that you can use the same to require controller files, just change the path to include the <code>controllers/</code> subdirectory as well.</p>
<h2>Testing ActionPack plugins</h2>
<h3>Controllers</h3>
<p>Testing a controller extension is somewhat easier than testing ActiveRecord extentions, all you basically need to do is to require:<br />
<pre>require &#8216;action_controller&#8217;<br />
require &#8216;action_controller/test_process&#8217;</pre></p>
<p>create <code>routes.rb</code> under <code>app/config</code>, add routes to match your controller and <strong>load</strong> it in <code>test_helper.rb</code>. Of course you&#8217;ll have to create the controller class under <code>app/controllers/</code> and the test files under <code>functionals/</code>.<br />
Your actual tests should look like regular rails functional tests.</p>
<h3>Helpers</h3>
<p>The straight forward approach is to <code>include</code> the helper&#8217;s class in the matching unit test, and test every helper method. Sometimes some helpers might expect ActiveRecord to be around as well, i suggest mocking (Using Ruby&#8217;s included <a href="http://ruby-doc.org/stdlib/libdoc/ostruct/rdoc/classes/OpenStruct.html">OpenStuct</a>) to avoid the mess.</p>
<h3>Testing Rake Tasks</h3>
<p>Some plugins offer rake tasks as part of their functionality, in order to test rake tasks you&#8217;ll need to require rake:<br />
<pre>require &#8216;rake&#8217;</pre><br />
and quickly setup a rake object on <code>test_helper.rb</code>:<br />
<pre>@rake = Rake::Application.new</pre></p>
<p><strong>load</strong> your tasks like you did with the <code>schema.rb</code> file and invoke tasks in your tests simply by:<br />
<pre>@rake[&#8220;db:migrate&#8221;].invoke</pre></p>
<h3>Your Rakefile</h3>
<p>Assuming you generated your plugin with the Rails <code>script/generate plugin</code> command, you should have a file name <code>Rakefile</code> in your plugin&#8217;s root directory that looks kind of like that:<br />
http://gist.github.com/232531</p>
<p>note that it loads several libs (lines 10-11), replicated these rows to include any library that you wish to include in the search path. In this file i included the <code>lib/</code> directory so i won&#8217;t have to require my files with a complete path, but by simply specifying their names (<code>require 'my_plugin'</code> instead of <code>require 'lib/my_plugin'</code>).</p>
<h2>oh yeah, your actual plugin code</h2>
<p>Well, if your plugin is well structured, you&#8217;ll have a <code>.rb</code> file under <code>lib/</code> named like your plugin, and if other files are required as well, that file will be responsible to require them.<br />
With that being said, the only thing that you&#8217;ll need to do is to actually include that file on <code>test_helper.rb</code>:<br />
<pre>require &#8216;lib/my_plugin&#8217;</pre> will require <code>lib/my_plugin.rb</code>. on the last note, you&#8217;ll have to include <code>test/unit</code> as well:<br />
<pre>require &#8216;test/unit&#8217;</pre></p>
<p>and you are all set. your plugin is available for standalone testing.</p>
		</div>
		<div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/emphasizedinsanity/embed.js"></script><noscript><a href="http://emphasizedinsanity.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>
    <div class="push"></div>
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog"><b>Home</b></a> |
            <a href="http://support.github.com/">Twitter</a> |
            <a href="http://github.com/training">LinkedIn</a> |
            <a href="http://github.com/contact">Facebook</a> |
            <a href="http://develop.github.com/">Github (my real account)</a> |
            <a href="http://twitter.com/github">WWR</a> |
            <a href="http://help.github.com/">Nautilus6</a>
          </div>
					<div class="company">
						<script type="text/javascript" src="http://s51.sitemeter.com/js/counter.js?site=s51eizesusrulez"></script>
						<a href="http://feeds.feedburner.com/EladOnRails"><img src="http://feeds.feedburner.com/~fc/EladOnRails?bg=FFFFFF&amp;fg=660033&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a>
					</div>
        </div>
				
        <div class="sponsor">
          <div>
        	</div>
      	</div>
    </div>
    
    
      <div id="facebox" style="display: none;">       <div class="popup">
         <table>           <tbody>             <tr>               <td 
class="tl"></td><td class="b"></td><td class="tr"></td>             </tr>
             <tr>               <td class="b"></td>               <td 
class="body">                 <div class="content">                 </div>
                 <div class="footer">                   <a href="#" 
class="close">                     <img src="index_files/closelabel.gif"
 title="close" class="close_image">                   </a>              
   </div>               </td>               <td class="b"></td>         
    </tr>             <tr>               <td class="bl"></td><td 
class="b"></td><td class="br"></td>             </tr>           </tbody>
         </table>       </div>     </div></body></html>