<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Emphasized Insanity - Force Fragment caching in a Rails model</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
	<script type="text/javascript" src="/javascripts/application.js"></script>
 	<link rel="stylesheet" type="text/css" href="/stylesheets/application.css">
  	<link rel="stylesheet" type="text/css" href="http://www.modrails.com/error_pages/1.0/error_page.css">	
	<link rel="alternate" type="application/rss+xml" title="Emphasized Insanity - Elad Meidar" href="http://feeds.feedburner.com/EladOnRails" />
</head>

<body>
	<div id="networkContainer">
		<div style="display: none;" id="toolbarContainer">
			<div id="menuToolbarContent">
				<a title="railsbridge.org" href="http://railsbridge.org">RailsBridge.org</a> | 
				<a title="railstutor.org" href="http://railstutor.org">Rails Courseware</a> | 
				<a title="RailsBridge Builders" href="http://builders.railsbridge.org">Builders</a> |
				<a title="railsmentors.org" href="http://railsmentors.org">Rails Mentors</a> | 
				<a title="teachingkids.railsbridge.org" href="http://teachingkids.railsbridge.org">Teaching Kids</a> | 
				<a title="wiki.railsbridge.org" href="http://wiki.railsbridge.org">RailsBridge Wiki</a> | 
				<a title="workshops.railsbridge.org" href="http://wiki.railsbridge.org/projects/railsbridge/wiki/Workshops">Workshops</a> | 
				<a title="rubychallenge.com" href="http://rubychallenge.com/">Ruby Challenge</a>
		 	</div>
		</div>
		<div id="networkToolbar">
			<div id="networkToolbarMargin"></div>
			<div id="networkToolbarContainer">
				<div id="networkToolbarTriger">
					<a id="menuTrigger" href="#"><img src="/images/rbnDownButton.png" alt="Toggle RailsBridge Network"/></a>
				</div>
			</div>
		</div>
	</div>
	<div id="site_container">
		<div id="site_header">
			<ul class="corporate_identity ">
				<li class="logo"><a href="http://blog.eizesus.com"><span>Phusion Passenger</span></a></li>
			</ul>
		</div>
		<div id="site_body">
<h1 class="error_title">Sanity not found in EladMeidar#life<em id="hint">Hi! this is not a real error, just a free rails blog themed template :)</em></h1>			
<div id="content">
	<ul id="accordion">
	<li class="first">
		
		<div class="container" >
			<div class="content" id="whereami">
				Hi! I'm Elad Meider<br/>
				I'm a <a href="http://railsbridge.org">Ruby on Rails</a> addict, an entrepreneur, a CEO of a web and mobile application development firm in Fort Lauderdale, a <a href="http://contributors.rubyonrails.org/contributors/elad-meidar/commits">Ruby on Rails contributor</a> and a <a href="http://www.railsmentors.org/users/185">Rails Mentor</a>.
				
			</div>
		</div>
	</li>
	<li class="last">
		<div class="container" >
			<div class="content">
				I'm also making regular appearances on:
				<ul>
					<li><a href="http://www.twitter.com/eladmeidar">Twitter</a></li>
					<li><a href="http://www.facebook.com/profile.php?id=629277362">Facebook</a></li>
					<li><a href="http://www.linkedin.com/in/eladmeidar">LinkedIn</a></li>
					<li><a href="http://www.workingwithrails.com/person/5844-elad-meidar">Working With Rails</a></li>
					<li><a href="http://github.com/eladmeidar">GitHub</a></li>
					<li>and #rubyonrails, #railsbridge, #facebook and #jquery on irc.freenode.net as <strong>eladmeidar</strong></li>
				</ul>
			</div>
		</div>
	</li>
	</ul>
	Further information about the error may have been written to the
	application's log file. Please check it in order to analyse the problem.
	
	<dl>
	<dt>Error message:</dt>
	<dd>uninitialized constant Sanity in EladMeidar#life</dd>
	
	<dt>Exception class:</dt>
	<dd>Sanity::NotFound</dd>
	
	<dt>Application root:</dt>
	<dd>
		<tt class="filename"><a href="http://blog.eizesus.com">http://blog.eizesus.com</a></tt>
	</dd>
	
	<dt>Backtrace:</dt>
	<dd>
		<div id="searchContainer">
			<form id="search" method="get" action="http://www.google.com/search?sitename=blog.eizesus.com">
				<input type="text" size="25" name="q" value="" maxlength="255"/><input type="submit" value="Search"/> or Check the <a href="/archive.html">Archive</a>

				<input type="hidden" name="sitesearch" value="blog.eizesus.com" checked=""/>

			</form>		
		</div>
		<table class="backtrace">
			<tr class="headers">
				<th>#</th>
				<th>File</th>
				<th>Location</th>
			</tr>
			<tr>
	<td colspan="3">
	    <h2><a href="/2009/7/force-fragment-caching-in-a-rails-model">Force Fragment caching in a Rails model</a></h2> 
	    <h3>29 Jul 2009</h3>

  
	  	<div class="entrybody">
	    	<p>When you are syndicating information that many users on your sites share, caching can easily save your life.<br />
One form of caching on Rails is called <strong>fargment caching</strong>, which you can read all about it in the fantastic <a href="http://guides.rubyonrails.org/caching_with_rails.html">Caching with Rails</a> guide.</p>
<p>Longer story short, Fragment caching allows you to cache a small partial of your rendered view instead of an action / page cache.<br />
it&#8217;s generally used for private user content that does not change too ofter, or to small partials of repetitive data that needs to be shared between many users (search results for example).</p>
<p>When Rails sees that you asked to cache something, it tries to fetch it. If it does not exists, it creates it, simple.</p>
<p>But what if you <span class="caps">KNOW</span> that you need it on cache and don&#8217;t want to wait to a request to cache that item, but you want to cache it immediately ?</p>
<p>Let&#8217;s try an example, this is an Article model:<br />
<pre><br />
class Article &lt; ActiveRecord::Base<br />
  validates_presence_of :title, :author_name<br />
end<br />
</pre></p>
<p>and a matching fragment cached partial, that renders a search result <span class="caps">HTML</span> for a single search result<br />
<pre><br />
&lt;% cache &#8220;search_result_&#8221; + article.id.to_s do <span>&gt;<br />
  <div class="article_result"><br />
    &lt;</span>= article.title <span>&gt; by &lt;</span>= article.author_name %&gt;</p>
</div>
<p>&lt;% end %&gt;<br />
</pre></p>
<div class="note">
<p>For this example we assume that the Article fields will never change, although that in real life you should be ready for that situtation. If you will follow the conventions, you&#8217;ll have no problem expiring a forced fragment.</p>
</div>
<p>the search results page would probably look something like:<br />
<pre><br />
<div id="results"><br />
  &lt;%= render :partial =&gt; &#8216;article_result&#8217;, :collection =&gt; @articles %&gt;</p>
</div>
<p></pre></p>
<p>Now, we will change our Article model to ensure we create the cached search result cached version, upon create:<br />
<pre><br />
class Article &lt; ActiveRecord::Base<br />
  validates_presence_of :title, :author_name</p>
after_create :force_fragment_cache
def force_fragment_cache

<ol>
	<li>We create the same key we would have created if we were caching in the view.<br />
    key = &#8220;search_result_&#8221; + self.id.to_s<br />
    av = ActionView::Base.new(Rails.configuration.view_path)<br />
    Rails.cache.write(<br />
      key, <br />
      av.render(<br />
        :partial =&gt; &#8220;search/article_result&#8221;, <br />
        :locals =&gt; {:article =&gt; self}<br />
      )<br />
    )<br />
  end<br />
end<br />
</pre></li>
</ol>
<p>And voila! all future requests for this article instance search result partial, will be served from cache. (as long as you have caching enabled).</p>
	  	</div>
		<div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/emphasizedinsanity/embed.js"></script><noscript><a href="http://emphasizedinsanity.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
	</td>
	
</tr>
		</table>
	</dd>
	</dl>

</div>

		</div>
		<p>
			<a href="http://feeds2.feedburner.com/EladOnRails"><img src="http://feeds2.feedburner.com/~fc/EladOnRails?bg=FFFFFF&amp;fg=444444&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a>
			<script type="text/javascript" language="javascript" src="http://twittercounter.com/embed/?username=eladmeidar&style=white"></script>
		</p>
		<p>
			<script type="text/javascript" src="http://s51.sitemeter.com/js/counter.js?site=s51eizesusrulez"></script>
			<noscript>
				<a href="http://s51.sitemeter.com/stats.asp?site=s51eizesusrulez" target="_top">
				<img src="http://s51.sitemeter.com/meter.asp?site=s51eizesusrulez" alt="Site Meter" border="0"/></a>
			</noscript>
		</p>
		<div id="site_footer">
			<!--
			   You are free to modify the footer as you see fit,
			   but we kindly ask of you to preserve to following
			   text. Thank you.
			-->
			<div class="container">
				Powered by <a href="http://www.modrails.com/">Phusion Passenger</a>,
				<tt>mod_rails</tt> / <tt>mod_rack</tt> for Apache.
			</div>
		</div>
	</div>
</body>
</html>

