<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Emphasized Insanity - Ruby on Rails and the quest for wealth</title>
  <style>
    body { background-color: #fff; color: #333; }

    body, p, ol, ul, td {
      font-family: verdana, arial, helvetica, sans-serif;
      font-size:   13px;
    }

    pre {
      background-color: #eee;
      font-size: 13px;
	  padding:10px;
    }
	
	.entry, #search {
		margin-top:10px;
		background:#eee;
		padding:10px;
	}
	
	#disqus_thread {
	  background-color: #eee;
      font-size: 13px;
	  padding:10px;	
	}
	
	#nakedrailer {
		float:right;
		margin:10px;
	}
	
	h2 { margin:0px; padding:0px ;}
    a { font-weight:bolder; color: #000; }
    a:hover { color: #fff; background-color:#000; }
  </style>
  <link rel="alternate" type="application/rss+xml" title="Emphasized Insanity - Elad Meidar" href="http://feeds.feedburner.com/EladOnRails" />
</head>
<body>
<img id="nakedrailer" src="/images/dddprog.png" alt="The naked Railer" title="The naked Railer"/>
<h1>
  Exception Caught in EladMeidar#life
</h1>
<pre>uninitialized constant Sanity</pre>



<p><code>RAILS_ROOT: <a href="http://blog.eizesus.com">http://blog.eizesus.com</a></code></p>

<div id="traces"> 
    <a href="#" onclick="document.getElementById('Framework-Trace').style.display='none';document.getElementById('Full-Trace').style.display='none';document.getElementById('Application-Trace').style.display='block';; return false;">Application Trace</a> |
    <a href="#" onclick="document.getElementById('Application-Trace').style.display='none';document.getElementById('Full-Trace').style.display='none';document.getElementById('Framework-Trace').style.display='block';; return false;">Framework Trace</a> |
    <a href="#" onclick="document.getElementById('Application-Trace').style.display='none';document.getElementById('Framework-Trace').style.display='none';document.getElementById('Full-Trace').style.display='block';; return false;">Full Trace</a> 
    <div id="Application-Trace" style="display: block;">
		 

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/deploying-ruby-on-rails-on-ec2-using-rubber">Deploying Ruby on Rails on EC2 - Using Rubber</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>25 Mar 2009 | <a href="/2009/3/deploying-ruby-on-rails-on-ec2-using-rubber#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <p>A while ago i wrote a post tutoring a <a href="http://blog.eizesus.com/2009/1/rails-and-amazon-ec2-beginners-guide">deployment of a simple rails application on ec2</a> using the EC2onRails gem,<br />
in this post i will explain how to use another plugin, called <strong>rubber</strong> that simplifies the deployment of more complex applications, those with multiple instances for example.</p>
<h4>Setting the other stuff we need</h4>
<p>Follow this section on <a href="http://blog.eizesus.com/2009/1/rails-and-amazon-ec2-beginners-guide#ec2_keypair">my previous Rails on EC2 post</a> to get your EC2 account <span class="caps">SSH</span> keypair first, <br />
Then, install he <code>amazon-ec2</code> gem:<br />
<pre class="brush: bash"><br />
$ sudo gem install amazon-ec2<br />
</pre><br />
the <code>AWS::S3</code> gem:<br />
<pre class="brush: bash"><br />
$ sudo gem install aws-s3<br />
</pre><br />
Our beloved <code>Capistrano</code>:<br />
<pre class="brush: bash"><br />
$ sudo gem install capistrano<br />
</pre><br />
and the <code>nettica</code> gem:<br />
<pre class="brush: bash"><br />
$ sudo gem install nettica<br />
</pre><br />
note that you only need to install the <code>nettica</code> gem if you need to automatically map specific instances to <a href="http://en.wikipedia.org/wiki/List_of_DNS_record_types">A Records</a>.</p>
<h4>Setup Your Application</h4>
<p>in your application root, install the <code>rubber</code> plugin:<br />
<pre class="brush: bash"><br />
$ script/plugin install git://github.com/wr0ngway/rubber.git<br />
</pre></p>
<h5>Generating Configuration</h5>
<p>and than the crazy part, you&#8217;ll have to generate a <code>rubber</code> deployment setup that matches your application needs. To do that you&#8217;ll have to choose on your own.<br />
Each one of these &#8220;configurations&#8221; contains one or more service that is needed for your application, such as Apache, Mysql, Sphinx and more, and some act as bundles that basically install a group<br />
of other services:</p>
<ul>
	<li>apache: Installs apache</li>
	<li>base: configuration needed by all other packages/services <strong>you must install this one anyway</strong>.</li>
	<li>complete_mysql:
	<ul>
		<li>minimal_mysql</li>
		<li>monit</li>
		<li>munin</li>
		<li>memcached</li>
	</ul></li>
	<li>complete_passenger_mysql:
	<ul>
		<li>base</li>
		<li>mysql</li>
		<li>apache</li>
		<li>passenger</li>
		<li>munin</li>
		<li>memcached</li>
	</ul></li>
	<li>cruise: the cruise-control (CI server).</li>
	<li>haproxy: the haproxy module.</li>
	<li>memcached: the memcached module</li>
	<li>minimal_mysql:
	<ul>
		<li>base</li>
		<li>mysql</li>
		<li>mongrel</li>
		<li>nginx</li>
		<li>haprox</li>
	</ul></li>
	<li>minimal_nodb:
	<ul>
		<li>base</li>
		<li>mongrel</li>
		<li>nginx</li>
		<li>haproxy</li>
	</ul></li>
	<li>mongrel: the mongrel cluster application server</li>
	<li>monit</li>
	<li>munin</li>
	<li>mysql</li>
	<li>mysql_cluster</li>
	<li>mysql_proxy</li>
	<li>nginx</li>
	<li>passenger</li>
	<li>sphinx</li>
</ul>
<p>The one that we will use is the one that was the most suitable for my application, the <code>complete_passenger_mysql</code>, so in your project root type:<br />
<pre class="brush: bash"><br />
$ script/generate vulcanize complete_passenger_mysql<br />
</pre></p>
<h5>Configuration Files</h5>
<p>now edit your <code>config/rubber/rubber.yml</code> and add your <code>access_key, secret_access_key, aws_account, ec2_key_name</code> and <code>ec2_key_file</code> (you can get all of those by following my <a href="http://blog.eizesus.com/2009/1/rails-and-amazon-ec2-beginners-guide#setup_account">previous post</a>).<br />
each service/bundle installs with  a set  configuration files, a <code>rubber-module.yml</code> file for configuring each module will be found in your <code>config/rubber</code> folder, a long side a <code>deploy-module.rb</code> file for deployment specific behavior.</p>
<p>As you can see, the configuration files are basically <span class="caps">ERB</span> templates.<br />
Some special variables are defined to handle and control the module:</p>
<table>
	<tr>
		<th>Variable</th>
		<th>Description</th>
	</tr>
	<tr>
		<td>@*path*</td>
		<td>The output path to write the transformed config file to</td>
	</tr>
	<tr>
		<td>@*read_cmd*</td>
		<td>The command to use for reading the original config file from, e.g. ‚Äúcrontab -l‚Äù</td>
	</tr>
	<tr>
		<td>@*write_cmd*</td>
		<td>The command to use for piping the transformed config file to, e.g. ‚Äúcrontab -‚Äù</td>
	</tr>
	<tr>
		<td>@post 	The</td>
		<td>command to run after generating the config file <span class="caps">ONLY</span> if it has changed</td>
	</tr>
	<tr>
		<td>@owner</td>
		<td>The owner the output file should have, e.g. ‚Äúroot‚Äù</td>
	</tr>
	<tr>
		<td>@group</td>
		<td>The group the output file should have, e.g. ‚Äúsystem‚Äù</td>
	</tr>
	<tr>
		<td>@perms</td>
		<td>The permissions the output file should have, e.g. 0644</td>
	</tr>
	<tr>
		<td>@additive</td>
		<td>Sets transformation to be additive, only replaces between given delimiters, e.g. @additive = [‚Äú## start‚Äù, ‚Äú## end‚Äù]</td>
	</tr>
</table>
<p>The variables set in <strong>bold</strong> are those you <strong>must</strong> supply.<br />
In addition, within the configuration files you can access to the rubber configuration objects <code>rubber_env</code> (rubber*.yml) and <code>rubber_instances</code> (instance*.yml).</p>
<p>to test your configuration run:<br />
<pre class="brush: bash"><br />
$ rake rubber:config<br />
</pre><br />
this will apply your configuration to your <code>development</code> environment, so you can check that everything is up and running.<br />
note that:</p>
<ol>
	<li>Configuration files that exist in config/rubber/common will be transformed for all hosts.</li>
	<li>Configuration files that exist in config/rubber/role/ will only be transformed on the hosts that are members of role_name.</li>
	<li>Configuration files that exist in config/rubber/host/ will only be transformed on the hosts with a hostname of host_name.</li>
</ol>
<p>and will override based on that order in favor of the most specific configuration and alphabet order of configuration files.</p>
<h4>Bootstrap and Deploy</h4>
<p>first, you&#8217;ll need to create your environment bootstrap, in this case, it&#8217;s production <code>production</code>:<br />
<pre class="brush: bash"><br />
$ <span class="caps">ALIAS</span>=production <span class="caps">ROLES</span>=web,haproxy,app,mysql_master,passenger cap rubber:create	<br />
</pre><br />
Note that this is a simple deployment, to use a little bit more complex deployment use something like:<br />
<pre class="brush: bash"><br />
$ <span class="caps">ALIAS</span>=web01 <span class="caps">ROLES</span>=web,haproxy, passenger cap rubber:create<br />
$ <span class="caps">ALIAS</span>=app01 <span class="caps">ROLES</span>=app cap rubber:create<br />
$ <span class="caps">ALIAS</span>=app02 <span class="caps">ROLES</span>=app cap rubber:create<br />
$ <span class="caps">ALIAS</span>=db01 <span class="caps">ROLES</span>=mysql_master cap rubber:create<br />
$ <span class="caps">ALIAS</span>=db02 <span class="caps">ROLES</span>=mysql_slave cap rubber:create	<br />
</pre><br />
after you finished setting up your Rubber configuration, it&#8217;s time to create the bootstrap:<br />
<pre class="brush: bash"><br />
$ cap rubber:bootstrap	<br />
</pre><br />
and then just the regular capistrano deployment fire starters:<br />
<pre class="brush: bash"><br />
$ cap deploy:check<br />
$ cap deploy:setup<br />
$ cap deploy:cold<br />
</pre></p>
<p>and that&#8217;s about it.</p>
<h4>A Final Note</h4>
<p>The process of configuring an instance, bootstarping, and delpoying will run on <strong>all the instances your have specified, old and new!</strong>, so you shoudl <strong>always</strong> check your configuration on a local/staging environment.</p>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/deploying-ruby-on-rails-on-ec2-using-rubber#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/rhmobile-mobile-apps-with-ruby">rhmobile: Mobile Apps with Ruby</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>24 Mar 2009 | <a href="/2009/3/rhmobile-mobile-apps-with-ruby#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <p>From the <a href="http://rhomobile.com/">rhmobile website</a>  :<blackquote>Rhomobile&#8217;s open source mobile application framework Rhodes lets you quickly build native mobile applications for all smartphone operating systems: iPhone, BlackBerry, Windows Mobile, Symbian and Android. These are true native device applications, which work with synced local data and take advantage of device capabilities such as <span class="caps">GPS</span> and <span class="caps">PIM</span> access.</blackquote></p>
<p>This looks kinda nice, it reminds me of <span class="caps">ERB</span> in some way, but it&#8217;s not.</p>
<h4>Links</h4>
<ul>
	<li><a href="http://github.com/rhomobile/rhodes/tree/master">Git repo</a></li>
	<li><a href="http://rhomobile.com/wiki/index.php?title=Mobilizing_Your_Application_with_Rhomobile">Getting Started</a> tutorias</li>
	<li>and <a href="http://rhomobile.com/documentation/faq"><span class="caps">FAQ</span></a></li>
</ul>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/rhmobile-mobile-apps-with-ruby#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/link_to_back_or_default">link_to_back_or_default</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>24 Mar 2009 | <a href="/2009/3/link_to_back_or_default#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <p>Linking back in Rails is not complicated, the basic syntax of the <code>link_to</code> helper supports this options pretty easily:<br />
<pre class="brush: ruby"><br />
link_to &#8220;Back&#8221;, :back<br />
</pre><br />
Which redirects to the url pointer by the request environment variable called <code>HTTP_REFERER</code>.</p>
<p>This is pretty straight forward, but what if the user clicked on this link from an email? or from twitter? then the  <code>HTTP_REFERER</code> variable sill be empty.<br />
In order to solve this, i tweaked the <code>link_to</code> helper to check if there&#8217;s a value in <code>HTTP_REFERER</code> before creating a link to it, So this <code>link_to_back_or_default</code> helper works exactly like <code>link_to</code> does, but redirects back if there is any value.</p>
<h4>How to set this up.</h4>
<p>Add a method in your <code>application_helper.rb</code>:<br />
<pre class="brush: ruby"><br />
def link_to_back_or_default(*args)<br />
     name = args.first<br />
     options = args<sup class="footnote"><a href="#fn1">1</a></sup> || {}<br />
     html_options = args<sup class="footnote"><a href="#fn2">2</a></sup></p>
unless @back_url = @controller.request.env[&#8220;HTTP_REFERER&#8221;]
@back_url = self.url_for(options)
end

if html_options
html_options = html_options.stringify_keys
href = html_options[&#8216;href&#8217;]
convert_options_to_javascript!(html_options, url)
tag_options = tag_options(html_options)
else
tag_options = nil
end
href_attr = &#8220;href=\&#8221;#{@back_url}\&quot;&quot; unless href
&#8220;&lt;a #{href_attr}#{tag_options}&gt;#{name || url}</a>&#8221;
<p>end<br />
</pre></p>
<h4>Example</h4>
<p>Let&#8217;s say you have a  <code>ProductController</code> in your application.<br />
When you redirect to <code>ProductsContoller#show</code> you want the <code>back</code> link to redirect to the last page if there is any, or point to the <code>ProductsController#index</code> if there isn&#8217;t any last page.<br />
That&#8217;s all you need to do:<br />
<pre class="brush: ruby"><br />
  link_to_back_or_default &#8216;Back&#8217;, products_url<br />
</pre></p>
<p>simple.<br />
Enjoy!</p>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/link_to_back_or_default#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/how-to-really-use-table">How to really use the <table> tag?</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>23 Mar 2009 | <a href="/2009/3/how-to-really-use-table#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <p>Tables became the scape got of bad design practices, many sites and programmers still relay on table based  layout-ing to properly align and position elements on a web page.<br />
The &#8220;standard <span class="caps">HTML</span> table tag&#8221;http://www.w3.org/TR/html4/struct/tables.html#h-11.2.1 can contain many useful and semantic sub tags that are not being used on many sites iv&#8217;e seen, even those who use the table tag for what&#8217;s it is actually made for. Tables.</p>
<p>This <a href="http://aenui.com/user-interface/designing-tables-for-usability/">excellent guide</a> (and <a href="http://www.webdesignfromscratch.com/html-tables.php">this one</a> and <a href="http://www.webdesignfromscratch.com/html-tables.php">this one</a>) shows some of the basics on how to really use the <code>&lt;table&gt;</code> tag.</p>
<p>Big thanks goes for <a href="http://www.shlomifish.org/">Shlomi Fish</a> (a fellow forum manager at <a href="http://www.dev.org.il/index.php">dev.org.il</a>), that keeps on showing me that he is smarter than me every time we engage conversation.</p>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/how-to-really-use-table#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/ie8-overview">IE8 Overview</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>22 Mar 2009 | <a href="/2009/3/ie8-overview#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <p>IE8 was release lately, sure it has some <a href="http://www.internetnews.com/software/article.php/3811526/IE+8+Release+Goes+Smoothly+Despite+Bugs.htm">bugs</a> but i still felt like checking it out again, since i already bothered to <a href="http://eizesus.com/2009/2/ie8-rc1-ie6-again">check out the RC0 release</a>.</p>
<h4>Feel</h4>
<p>pretty much the same as IE7, not real change.</p>
<h4>Speed.</h4>
<p>Microsoft <a href="http://arstechnica.com/microsoft/news/2009/03/week-in-microsoft-is-ie8-a-fast-browser.ars">claim that IE8 is a faster than FF3 and Chrome</a>. <br />
well. it&#8217;s not.<br />
What it&#8217;s actually is, is an improvment to IE7 which is slow as getting into your car, drive up to the server farm where the website you are trying to view is hosted, print the code, drive back home and write back the <span class="caps">HTML</span>.<br />
Seriously, still no match for FF and Chrome.</p>
<h4>Features</h4>
<p>Aside from the already heavily discusses Security features, private browsing and the IE7 compatibility nonsense, i didn&#8217;t really find any new and exciting features in this browser.<br />
oh, i&#8217;m sorry&#8230; you can choose the colors for <span class="caps">HTML</span> tags.. very important. sheesh.</p>
<h4>Compatibility</h4>
<p>IE8 supports more standards than IE7, which is good, but i still found some weird issues with Float elements.. i guess it&#8217;s still a Microsoft browser after all.</p>
<h3>Conclusion</h3>
<p>Not yet, Microsoft are trying to do their best, but so far it feels like they are just shooting in the dark with IE8.<br />
Yes, it&#8217;s a better browser than IE7 and IE6 (duh!) but it&#8217;s still not as good as <a href="http://www.getfirefox.com">Firefox</a> <a href="http://www.google.com/chrome">chrome</a> or <a href="http://www.apple.com/safari/download/">safari</a>.</p>
<p><strong>Links</strong></p>
<ul>
	<li><a href="http://www.apple.com/safari/download/">Drop IE6</a></li>
	<li><a href="http://www.dansimard.com/not_tested_in_ie">Dropping IE at all</a></li>
	<li><a href="http://www.microsoft.com/windows/internet-explorer/default.aspx">Download IE8</a></li>
</ul>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/ie8-overview#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/jquery-s-ready-runs-before-load-event">JQuery's ready() runs before load() event?</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>21 Mar 2009 | <a href="/2009/3/jquery-s-ready-runs-before-load-event#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <p>In the JQuery documentation entry about <a href="http://docs.jquery.com/Events/ready" title="">ready</a>, it&#8217;s mentioned that the ready() function is somewhat a replacement to the onload event, and should be used to traverse and manipulate the <span class="caps">DOM</span> when it&#8217;s ready.</p>
<h4>What is &#8220;when it&#8217;s ready&#8221; than?<br />
When the <span class="caps">DOM</span> is ready, means that the browser finished reading all your document, parsed it and is ready to display it, <strong>but still didn&#8217;t display it</strong> so nothing is visible yet. That means that if you need to make some <abbr title="Graphical User Interface"><span class="caps">GUI</span></abbr> adjustments, that&#8217;s the place.<br />
if you use the <code>onload</code> event callback, the function will run <strong>after</strong> the document is displayed, not only parsed.<br />
For example, if we want a hidden paragraph to show:<br />
<pre class="brush: xml"><br />
 <p style="display:none"><br />
     hi! i&#8217;m hidden!</h4>
</p>
<p></pre><br />
Using the <code>ready()</code> callback like that:<br />
<pre class="brush: js"></p>
<p>$(document).ready(function () {<br />
    $(&#8220;p.hidden&#8221;).fadeIn();<br />
})<br />
</pre><br />
will trigger the <code>fadeIn</code> effect before the page is displayed, and by that probably will cause the fade effect to look weird .</p>
<p>using the <code>onload</code> event:<br />
<pre class="brush: js"><br />
// <span class="caps">ATTN</span>: runs on window, not on document<br />
$(window).load(function(){<br />
    $(&#8220;p.hidden&#8221;).fadeIn();<br />
})<br />
</pre><br />
will first display the page without the hidden paragraphs and when the page is displayed <strong>and</strong> ready, the <code>fadeIn</code> effect will kick in</p>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/jquery-s-ready-runs-before-load-event#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/generate-a-rails-appplication-template">Generate a Rails Appplication online</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>20 Mar 2009 | <a href="/2009/3/generate-a-rails-appplication-template#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <p>I fear the rails community is getting closer and closer to fulfill my vision of <code>acts_as_what_i_want</code>plugin.<br />
<a href="http://www.youvegotrails.com/">YouveGotRails.com</a> allows one to generate a rails application with plugins and gems of choice, along side some extra configuration options (Git and Capistrano Initialization).</p>
<p>Nice, useful?</p>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/generate-a-rails-appplication-template#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/rails-nested-resources-tutorial">Rails Nested Resources Tutorial</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>19 Mar 2009 | <a href="/2009/3/rails-nested-resources-tutorial#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <h2>Preface</h2><p>The best way to get started with Rails 2.x nested routing and routing at all, is to read the official <a href="http://guides.rails.info/routing.html">Rails Routing</a> guide at the <a href="http://guides.rails.info/">Rails Guides</a> website.<br />
<br />
<h2>Rails Nested Routes/Resources</h2>The rails nested routes/resources were indroduced at Rails 1.2 as part of the RESTful approach that was adopted by the Rails core members.<br />
Nested resources allowed urls like:<br />
<pre class="brush: bash">/tasks/?project_id=1</pre><br />
To have a bit more sexy/RESTful look:<br />
<pre class="brush: bash">/projects/1/tasks</pre><br />
<br />
LetÔøΩs use this example to make things a little more clear, we will use 2 models, Project and Task<br />
<br />
<pre class="brush: ruby"></p>
<ol>
	<li>/app/models/project.rb<br />
class Project &lt; ActiveRecord::Base<br />
	has_many :tasks<br />
end</li>
</ol>
<ol>
	<li>/app/models/task.rb<br />
class Task &lt; ActiveRecord::Base<br />
	belongs_to :project<br />
end<br />
</pre><br />
<br />
<h2>Setting up routes.rb</h2><h3>Creating a Nested Resource</h3><h4>:has_many keyword</h4>The easiest way to create a nested route, is to use the :has_many keyword like that:<br /></li>
</ol>
<pre class="brush: ruby">
# /config/routes.rb
map.resources :projects, :has_many =&amp;gt; :tasks

# and the correspondent task resource
map.resources :tasks
</pre>
<p><br />
Adding the second routes, that defines a RESTful route to :tasks, depends if you would like to allow an access to the Task resource, without the project context, this is not a must.<br />
<br />
<h4>Block</h4><br />
You can also specify the sub-resources in a block<br />
<pre class="brush: ruby"><br />
map.resources :projects do |project|<br />
	project.resources :tasks<br />
end<br />
</pre><br />
<h4>Singular Resources</h4>Just the same:<br />
<pre class="brush: ruby"><br />
map.resources :projects do |project|<br />
	project.resource :design_document<br />
end<br />
</pre><br />
<h3>Routes Helpers</h3>Run:<br />
<pre class="brush: bash">$ rake routes</pre><br />
to see what kind of routes do you have in your application, you can pipe UNIXÔøΩs grep command (ÔøΩ| grep xxxÔøΩ) to filter the results: <br />
<pre class="brush: bash">$ rake routes | grep project</pre><br />
<br />
A basic <code>map.resources :projects</code> will produce:<br />
<pre class="brush: bash">                 <br />
            events <span class="caps">GET</span>    /projects         <br />
formatted_projects <span class="caps">GET</span>    /projects.:format        <br />
                   <span class="caps">POST</span>   /projects         <br />
                   <span class="caps">POST</span>   /projects.:format <br />
       new_project <span class="caps">GET</span>    /projects/new</p>
<p></pre></p>
<p><br />
but for a Nested route, like we defined before will produce:<br />
<pre class="brush: bash"><br />
 project_tasks     <span class="caps">GET</span> /projects/:project_id/tasks<br />
new_project_task   <span class="caps">GET</span> /projects/:project_id/tasks/new<br />
edit_project_task  <span class="caps">GET</span> /projects/:project_id/tasks/:id/edit<br />
project_task       <span class="caps">GET</span> /projects/:project_id/tasks/:id<br />
</pre><br />
sweet.<br />
<br />
<h4>Singular Nested Route Helpers</h4><br />
(from the example above)<br />
<pre class="brush: bash"><br />
/projects &#8211; list all projects<br />
/projects/1 &#8211; show a single project<br />
/projects/1/design_document &#8211; a projectÔøΩs design document<br />
</pre><br />
<br />
<h3>Using the routing helpers</h3><br />
Since we now have another resource in context when we want o use the new helpers, we need to include that resource instance as a paramter:<br />
<pre class="brush: ruby"><br />
new_project_task(@project)</p>
<ol>
	<li>or when both resources are required<br />
edit_project_task(<code>project, @task)
&lt;/pre&gt;
&lt;br /&gt;
&lt;h2&gt;Forms&lt;/h2&gt;&lt;br /&gt;
I'll assume you use form_for in your forms, it will make the usage of nested resources a lot easier than to work with plain HTML or form_tag.&lt;br /&gt;
The regular form we know of form_for, receives one instance as the form object:&lt;br /&gt;
&lt;pre class="brush: rails"&gt;
&amp;lt;% form_for(</code>project) do |f| <span>&gt;<br />
	&#8230;<br />
&lt;</span> end <span>&gt;<br />
</pre><br />
But with nested resources, we&#8217;ll pimp it up a little bit:<br />
<br />
<pre class="brush: rails"><br />
&lt;</span> form_for([ @project, @task ]) do |f| <span>&gt;<br />
	&#8230;<br />
&lt;</span> end %&gt;<br />
</pre><br />
Note the instances array, that specifies the objects we need in our form when we deal with nested resources<br />
<br />
<h2>Controller</h2><br />
In the most basic way of nested resources, the nested resource is inaccessible without the context of the parent resource.<br />
This example explains how to handle that kind of situation.<br />
Well, we do know that we get at least 1 id when we deal with nested resources, the parent resource&#8217;s id, remember?<br />
<pre class="brush: bash"><br />
/projects/1/tasks/new<br />
</pre><br />
so we&#8217;ll add a <code>before_filter</code> to get the project instance:<br />
<pre class="brush: ruby"></li>
	<li>on TasksControlller<br />
before_filter :get_project</li>
</ol>
<p>private<br />
def get_project<br />
	@project = Project.find(params[:project_id])<br />
end<br />
</pre><br />
So we&#8217;ll have our parent resource whenever we do it. in our actions we can use the parent resource instance to create the nested resource:<br />
<pre class="brush: bash"></p>
<ol>
	<li>TasksController<br />
def create<br />
	@project.tasks.build(params[:task])<br />
	if @project.save<br />
   		respond_to &#8230;<br />
   		end<br />
	else<br />
   		respond_to &#8230;<br />
   		end<br />
	end<br />
end<br />
</pre></li>
</ol>
<h2>Conclusion and some Gotchas.</h2><p><br />
Using nested resources and routes is the right thing, URLs are clear, and code is readable. but:<br />
<br />
<ul><br />
<li>You <a href="http://weblog.jamisbuck.org/2007/2/5/nesting-resources">should not implement nested resources of more than 2 levels</a>.</li><br />
<li>Setting up <a href="http://www.espace.com.eg/blog/2008/01/18/restful-pagination-in-rails/">pagination support</a> (?page=3) kind of breaks the RESTful approach.</li><br />
<li>The railscast about <a href="http://railscasts.com/episodes/139-nested-resources">Nested Resources</a>.</li><br />
<li><a href="http://ryandaigle.com/articles/2009/2/1/what-s-new-in-edge-rails-nested-attributes">Ryan Daigle</a> about nested_attributes and how to use them with nested resources</li><br />
<li>Using <a href="http://github.com/ratnikov/ajax_resource/tree/master">RESTful ajax</a> calls, a great lib by dfr|work (#rubyonrails).</li></p>
</ul>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/rails-nested-resources-tutorial#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/storing-files-in-ruby-on-rails">Storing Files in Ruby on Rails</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>18 Mar 2009 | <a href="/2009/3/storing-files-in-ruby-on-rails#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <div style="-moz-background-clip: -moz-initial; -moz-background-inline-policy: -moz-initial; -moz-background-origin: -moz-initial; background: yellow none repeat scroll 0% 0%; border: 3px solid orange; margin: 10px; padding: 5px;">Note: <a href="http://www.afreshcup.com/">Mike Gunderloy</a> has brought to my attention while writing this post, that the guys at <a href="http://therailsway.com/">therailsway.com</a> already did something like that. well.. i finished it anyway, but i&#8217;m sure <a href="http://therailsway.com/2009/3/16/storing-your-files">their post</a> is at least half as good :).<br />
I finished my post before reading theirs and didn&#8217;t add things Koz wrote and i didn&#8217;t,&nbsp; so don&#8217;t blame me in stealing or something. :)</div><p>Some noob at #rubyonrails (irc.freenode.net) asked a question a few days ago about some issue he had while <b>storing uploaded files as BLOBs in his database</b>.<br />
I Know storing files in a database is usually a bad idea, but i still thought about the face that i was yet to see a propar guidance on how to handle files (using the correct practices of course).<br />
<br />
<b><span style="font-size: large;">Plugins</span></b><br />
<a href="http://clarkware.com/cgi/blosxom/2007/02/24">Attachement_fu</a> &#8211; The older brother, pretty nice, better than the late file_column.<br />
<br />
<a href="http://jimneath.org/2008/04/17/paperclip-attaching-files-in-rails/">PaperClip</a> &#8211; An &#8220;updated&#8221; attachement_fu, some people say it&#8217;s better than attachement_fu because it is actually working. There is a lot more work being done on this plugin now a days, so it&#8217;s better to relay on it rather than on attachment_fu.<br />
<br />
<b><span style="font-size: large;">Storing your files.<br />
</span></b><br />
<b>Local File System</b><br />
<span style="font-size: small;">This option can only work out for you, if you are running your app on a single server, simply set one of the plugins to store the uploaded files whereever you want, and that&#8217;s it.</span><br />
<span style="font-size: small;">You can also setup a network folder if you&#8217;d like and imitate a local folder across a number of servers, but i&#8217;s the same. <br />
</span><br />
<span style="font-size: small;">What you do need to be careful from, is a situation where you are saving too many files into a single folder, which will cause mainly for a slow file lookup.</span><br />
<span style="font-size: small;">Try to refine you directory structures for your upload root in order to avoid such a problem.</span><br />
<br />
<span style="font-size: small;"><b>Amazon S3</b></span><br />
The main reasons to use Amazon S3 are that it&#8217;s amazingly scalable and incrediably cheap. Other than that it&#8217;s pretty easy to manage using the plugins or some gems around there, and it&#8217;s generally offloading the weight of sending files to your users an keeping your application servers busy (i wrote before on <a href="http://blog.eizesus.com/2008/07/apache-x-sendfile-in-rails.html">apache&#8217;s x-sendfile</a> header, that&#8217;s another way).<br />
<br />
<b>and&#8230; still.. BLOBs</b><br />
As i said before, i am not a fan of storing files in your db, seems like out of context for me, but some people like it.<br />
If you insist (<a href="http://mysqldump.azundris.com/archives/36-Serving-Images-From-A-Database.html">and you shouldn&#8217;t</a>) , you&#8217;ll need to setup a <a href="http://rpheath.com/posts/52-rails-migrations-for-blobs">proper migration</a> to handle BLOBs, and the rest is up to you.</p>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/storing-files-in-ruby-on-rails#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

  <div class="entry">
  	<div class="entrytitle">
  		<h2><a href="/2009/3/raphael-amazing-vector-graphics-javascript-libraty">Raphael: Amazing vector graphics Javascript Library</a> <span class="author"> by Elad Meidar</span></h2> 
  		<h3>18 Mar 2009 | <a href="/2009/3/raphael-amazing-vector-graphics-javascript-libraty#disqus_thread" class="commentslink">View comments</a></h3>
  	</div>
  	
  	<div class="entrybody">
  	  <quote>RaphaÎl is a small JavaScript library that should simplify your work with vector graphics on the web. If you want to create your own specific chart or image crop and rotate widget, for example, you can achieve it simply and easily with this library.<br /></quote><p><br />
<br />
<br />
Raphael Supports Firefox 3.0+, Safari 3.0+, Opera 9.5+ and Internet Explorer 6.0+ which is pretty awesome and allows you to do almost any graphic task you have in mind, just check the demos.<br />
Raphael weighs about 110kb uncompressed, which is kind of an issue i think.<br />
<br />
Get it here at the <a href="http://raphaeljs.com/">Raphael Homepage</a></p>
  	</div>
  	
  	<div class="entrymeta">
  	  <a href="/2009/3/raphael-amazing-vector-graphics-javascript-libraty#disqus_thread" class="commentslink">View comments</a>
  	</div>
  </div>

 
<div class="archive_link">
  <a href="/archive.html">View all previous posts in archive &raquo;</a>
</div>
    </div>
    <div id="Framework-Trace" style="display: none;">
		<div class="entry">
		<p>
			My name is <a href="http://www.eizesus.com">Elad Meidar</a>, i'm an Israeli entrepreneur and a web developer currently based in Florida, USA.<br/>
  			I am currently running a vivid Rails and mobile applications development firm in Fort Lauderdale, Consulting Venture Capitals in the US and totally crazy about Ruby on Rails.<br/>
		</p>
		<ul>
			<li><a href="http://www.twitter.com/eladmeidar">Twitter</a></li>
			<li><a href="http://www.facebook.com/profile.php?id=629277362">Facebook</a></li>
			<li><a href="http://www.linkedin.com/in/eladmeidar">LinkedIn</a></li>
			<li><a href="http://www.workingwithrails.com/person/5844-elad-meidar">Working With Rails</a></li>
			<li><a href="http://www.railsmentors.org/users/185">Rails Mentors</a></li>
			<li><a href="http://github.com/eladmeidar">GitHub</a></li>
			<li>#rubyonrails, #railsbridge, #facebook and #jquery on irc.freenode.net as <strong>eladmeidar</strong></li>
		</ul>
		<p>
		<a href="http://contributors.rubyonrails.org/contributors/elad-meidar/commits"><img src="http://www.workingwithrails.com/images/rails-core-contributor.gif?1213632569" alt="Rails Core Contributor" title="Rails Core Contributor"/></a>
		</p>
		<p>
			<a href="http://www.railsbridge.org" title="An inclusive and friendly Ruby on Rails community.">
			<img src="http://www.railsbridge.org/images/railsbridge_badge.png" alt="RailsBridge Badge" /></a>
		</p>
		</div>
    </div>
  
    <div id="Full-Trace" style="display: none;">
		<div id="twitter_div" class="entry">
			<ul id="twitter_update_list"></ul>
			<a href="http://twitter.com/eladmeidar">Follow me on Twitter!</a>
		</div>
    </div>
</div>

<h2 style="margin-top: 30px">Request</h2>
<p><strong>Parameters</strong>:
	<form id="search" method="get" action="http://www.google.com/search?sitename=blog.eizesus.com">
	<input type="text" size="25" name="q" value="" maxlength="255"/><input type="submit" value="Search"/>

	<input type="hidden" name="sitesearch" value="blog.eizesus.com" checked=""/>
	
	</form></p>
</div>


<h2 style="margin-top: 30px">Response</h2>
<p><b>Headers</b>:
<div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/emphasizedinsanity/embed.js"></script><noscript><a href="http://emphasizedinsanity.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</p>

<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/eladmeidar.json?callback=twitterCallback2&amp;count=10"></script>
<p>
	<a href="http://feeds2.feedburner.com/EladOnRails"><img src="http://feeds2.feedburner.com/~fc/EladOnRails?bg=FFFFFF&amp;fg=444444&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a>
	<script type="text/javascript" language="javascript" src="http://twittercounter.com/embed/?username=eladmeidar&style=white"></script>
</p>
<p>
	<script type="text/javascript" src="http://s51.sitemeter.com/js/counter.js?site=s51eizesusrulez"></script>
	<noscript>
		<a href="http://s51.sitemeter.com/stats.asp?site=s51eizesusrulez" target="_top">
		<img src="http://s51.sitemeter.com/meter.asp?site=s51eizesusrulez" alt="Site Meter" border="0"/></a>
	</noscript>
</p>
</body>
</html>